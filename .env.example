# ===================================================
# DEVELOPMENT ENVIRONMENT EXAMPLE
# ===================================================
# Copy this file to .env and fill in your values

# DATABASE - Use Supabase Postgres
# Get password from: https://app.supabase.com/project/jeqxfoecmhgmulcyoiqy/settings/database
# Format: postgresql://postgres:PASSWORD@db.PROJECT_ID.supabase.co:5432/postgres
DATABASE_URL="postgresql://postgres:your_password_here@db.jeqxfoecmhgmulcyoiqy.supabase.co:5432/postgres"

# SUPABASE - For persistence layer
SUPABASE_URL="https://jeqxfoecmhgmulcyoiqy.supabase.co"
SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImplcXhmb2VjbWhnbXVsY3lvaXF5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzMTIzNjcsImV4cCI6MjA4MDg4ODM2N30.4Nthl4ZpiarqYgW_EepOpoquKySeZxz1V-lBVa7gm2g"
SUPABASE_SERVICE_ROLE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImplcXhmb2VjbWhnbXVsY3lvaXF5Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NTMxMjM2NywiZXhwIjoyMDgwODg4MzY3fQ.PCK4xWDnrK2K6enbZsYhYeFzSOfVIeS0VaU0nPAmmQI"

# PAYMENT GATEWAYS

# PayFast (South Africa)
PAYFAST_MERCHANT_ID="10002011"
PAYFAST_MERCHANT_KEY="xm84k83k4nwqm3k"
PAYFAST_PASSPHRASE="dev_passphrase"

# Stripe (International)
STRIPE_SECRET_KEY="sk_test_your_stripe_key"
STRIPE_PUBLISHABLE_KEY="pk_test_your_stripe_key"
STRIPE_WEBHOOK_SECRET="whsec_your_webhook_secret"

# PayPal
PAYPAL_CLIENT_ID="your_paypal_client_id"
PAYPAL_CLIENT_SECRET="your_paypal_secret"
PAYPAL_MODE="sandbox"

# EMAIL CONFIGURATION

# SendGrid
SENDGRID_API_KEY="SG.your_sendgrid_key"

# SMTP (Gmail, Mailgun, etc.)
SMTP_HOST="smtp.gmail.com"
SMTP_PORT="587"
SMTP_USER="your-email@gmail.com"
SMTP_PASSWORD="your-app-password"
SMTP_FROM="noreply@spiritualhealer.com"

# SMS CONFIGURATION

# Twilio
TWILIO_ACCOUNT_SID="your_twilio_sid"
TWILIO_AUTH_TOKEN="your_twilio_token"
TWILIO_PHONE_NUMBER="+1234567890"

# Africa's Talking
AFRICAS_TALKING_API_KEY="your_africas_talking_key"
AFRICAS_TALKING_USERNAME="your_africas_talking_username"

# APPLICATION

# Node environment
NODE_ENV="development"

# Server port
PORT="5000"

# CORS settings
CORS_ORIGIN="http://localhost:5000,http://localhost:3000"

# Session secret (generate random string for production)
SESSION_SECRET="your-random-session-secret-change-in-production"

# Optional: API keys for third-party services
GOOGLE_MAPS_API_KEY="your_google_maps_key"
GOOGLE_ANALYTICS_ID="your_google_analytics_id"

# Linux:
sudo apt-get install postgresql postgresql-contrib

# Windows: Download from https://www.postgresql.org/download/windows/
```

### Create Database

```bash
# Connect to PostgreSQL
psql -U postgres

# Create database
CREATE DATABASE cultural_powers;

# Create user with password
CREATE USER cp_user WITH PASSWORD 'secure_password_here';

# Grant privileges
ALTER ROLE cp_user SET client_encoding TO 'utf8';
ALTER ROLE cp_user SET default_transaction_isolation TO 'read committed';
ALTER ROLE cp_user SET default_transaction_deferrable TO on;
GRANT ALL PRIVILEGES ON DATABASE cultural_powers TO cp_user;

# Exit
\q
```

### Environment Variables

Create `.env.local` in the root directory:

```
# Database
DATABASE_URL=postgresql://cp_user:secure_password_here@localhost:5432/cultural_powers

# Application
NODE_ENV=development
APP_URL=http://localhost:5000
PORT=5000

# Payment Gateways

## PayFast (South Africa)
PAYFAST_MERCHANT_ID=your_payfast_merchant_id
PAYFAST_MERCHANT_KEY=your_payfast_merchant_key
PAYFAST_PASS_PHRASE=your_payfast_pass_phrase

## Stripe
STRIPE_PUBLIC_KEY=pk_test_your_stripe_public_key
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key

## PayPal
PAYPAL_CLIENT_ID=your_paypal_client_id
PAYPAL_CLIENT_SECRET=your_paypal_client_secret

# Email Service (for notifications)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASSWORD=your_app_password
SMTP_FROM=noreply@culturalpowers.co.za

# SMS Service (for notifications)
SMS_API_KEY=your_sms_api_key
SMS_API_URL=https://api.sms-provider.com

# Push Notifications
VAPID_PUBLIC_KEY=your_vapid_public_key
VAPID_PRIVATE_KEY=your_vapid_private_key

# Analytics
GOOGLE_ANALYTICS_ID=UA-xxxxxxxx-x

# Security
JWT_SECRET=your_jwt_secret_key_here
SESSION_SECRET=your_session_secret_key_here
```

## Database Migration

```bash
# Push schema to database
npm run db:push

# Generate migrations
npx drizzle-kit generate

# Migrate database
npx drizzle-kit migrate
```

## Payment Gateway Setup

### PayFast (Recommended for South Africa)

1. Sign up at https://www.payfast.co.za
2. Get merchant ID, merchant key, and pass phrase
3. Add to `.env.local`
4. Set return/notify URLs in PayFast dashboard:
   - Return URL: `https://yourdomain.com/checkout/confirmation`
   - Notify URL: `https://yourdomain.com/api/payments/payfast/notify`

### Stripe

1. Create account at https://stripe.com
2. Get API keys from dashboard
3. Add to `.env.local`
4. Set webhook endpoint: `https://yourdomain.com/api/payments/stripe/webhook`

### PayPal

1. Create business account at https://developer.paypal.com
2. Get client ID and secret
3. Add to `.env.local`
4. Test in sandbox mode first

## Running the Application

### Development

```bash
cd Spirit-Healer-AI
npm install
npm run dev
```

Server will start on `http://localhost:5000`

### Production Build

```bash
npm run build
npm start
```

## Database Seeding

Create `seed.ts` in the `scripts` directory:

```typescript
import { db } from "../server/db";
import { services, products, serviceCategories } from "../shared/schema";

async function seed() {
  // Add service categories
  await db.insert(serviceCategories).values([
    { name: "Cleansing", slug: "cleansing", description: "Spiritual cleansing rituals" },
    { name: "Protection", slug: "protection", description: "Protection services" },
    { name: "Healing", slug: "healing", description: "Healing services" },
  ]);

  // Add services
  await db.insert(services).values([
    {
      title: "Curse Removal",
      slug: "curse-removal",
      categoryId: 1,
      shortDescription: "Remove negative curses",
      fullDescription: "Professional curse removal service",
      priceMin: "350",
      priceMax: "800",
      imageUrl: "/services/curse-removal.jpg",
      isActive: true,
      isFeatured: true,
    },
    // Add more services...
  ]);

  console.log("âœ“ Database seeded successfully");
}

seed().catch(console.error);
```

Run with: `npx tsx scripts/seed.ts`

## Deployment

### Vercel (Recommended)

```bash
# Install Vercel CLI
npm i -g vercel

# Deploy
vercel

# Set environment variables in Vercel dashboard
```

### Docker

Create `Dockerfile`:

```dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .

EXPOSE 5000

CMD ["npm", "start"]
```

Build and run:

```bash
docker build -t cultural-powers .
docker run -e DATABASE_URL=postgresql://... -p 5000:5000 cultural-powers
```

## Monitoring and Logging

```typescript
// Enable logging in development
import { log } from "./server/index";

log("Important message");
```

## Testing

```bash
# Run tests
npm run test

# Coverage
npm run test:coverage
```

## Troubleshooting

### Database Connection Issues

```bash
# Test connection
psql DATABASE_URL

# Check logs
tail -f /var/log/postgresql/
```

### Payment Gateway Issues

- Check API keys are correct
- Verify URLs are accessible
- Check PayFast test mode settings
- Review sandbox vs production endpoints

### Performance

- Enable query logging: `DATABASE_DEBUG=true`
- Use connection pooling
- Cache static assets
- Monitor with analytics dashboard at `/admin/analytics`

## Support

For issues, check:
1. Server logs: `/var/log/cultural-powers/`
2. Database logs: `psql` command line
3. Payment gateway dashboards
4. Application analytics at `/admin/analytics`
